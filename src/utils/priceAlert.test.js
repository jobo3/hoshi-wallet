import { checkPriceAlerts } from "./priceAlert"

const marketData = [
  {
    "id": "bitcoin",
    "symbol": "btc",
    "name": "Bitcoin",
    "image": "https://assets.coingecko.com/coins/images/1/large/bitcoin.png?1547033579",
    "current_price": 36364,
    "market_cap": 686789241523,
    "market_cap_rank": 1,
    "fully_diluted_valuation": 761430536615,
    "total_volume": 25817800958,
    "high_24h": 39216,
    "low_24h": 35580,
    "price_change_24h": -1733.145742703106,
    "price_change_percentage_24h": -4.5493,
    "market_cap_change_24h": -35621738791.48572,
    "market_cap_change_percentage_24h": -4.93095,
    "circulating_supply": 18941418.0,
    "total_supply": 21000000.0,
    "max_supply": 21000000.0,
    "ath": 69045,
    "ath_change_percentage": -47.44459,
    "ath_date": "2021-11-10T14:24:11.849Z",
    "atl": 67.81,
    "atl_change_percentage": 53413.1906,
    "atl_date": "2013-07-06T00:00:00.000Z",
    "roi": null,
    "last_updated": "2022-01-27T17:57:51.216Z",
    "sparkline_in_7d": {
      "price": [
        42210.41697932467,
        42078.59816595068,
        42457.09178193016,
        43120.58908265619,
        43308.03956681778,
        43299.353057524866,
        43056.540669581744,
        43149.926635185744,
        42946.95943008196,
        42612.93819242102,
        41368.03820513283,
        41244.72558790132,
        40707.6824143097,
        41011.486226241585,
        39502.20976924315,
        40005.428327993286,
        38595.357998473075,
        38972.1426142197,
        39069.60851847918,
        38825.08225149761,
        39285.10057661805,
        39282.13205482304,
        39146.98486305409,
        39029.01940763461,
        38972.112801224925,
        37978.94600196123,
        38683.65020437281,
        38477.708224151065,
        39161.402329147226,
        38684.34956161961,
        38357.71969772329,
        38555.043969645936,
        38203.1890035537,
        38178.00057195512,
        36018.680208090766,
        35761.710943672675,
        36385.341362730935,
        36342.22689553229,
        36637.351584595846,
        36639.176855482365,
        36317.547348304455,
        36412.4702263163,
        35732.43347988268,
        35869.70749858731,
        35580.66865547844,
        35692.12145599295,
        34658.69118169887,
        35631.29321200412,
        35423.733623564774,
        35952.32534384478,
        35680.11740179815,
        35193.74160008464,
        34991.02054654133,
        35109.6564826399,
        34631.73103161949,
        34527.6528378289,
        34602.79496883843,
        35464.161836675376,
        35630.207411484356,
        34935.31059784646,
        35180.435462830384,
        35432.61134395314,
        35448.608106994194,
        35044.59262923074,
        35176.65728559375,
        35348.42857530886,
        35591.25705774395,
        35342.902225939535,
        35673.892148853825,
        35760.80532005177,
        35974.488705639684,
        35898.49265417996,
        35764.30539081825,
        35924.69475847814,
        36066.53867510662,
        35208.08509273927,
        35476.641272607,
        35363.39608281859,
        35472.73143627676,
        35005.57945651765,
        34804.560652713786,
        35332.049887473404,
        35566.67303014184,
        35578.38113726986,
        36306.409440464704,
        35976.423803204576,
        35614.40208623434,
        35298.369056622185,
        35460.9591035379,
        35166.47782220354,
        35324.32911966495,
        35343.877431574896,
        34933.391099907014,
        35059.2341729153,
        34484.25372879889,
        33505.71385790957,
        33795.32406494986,
        33520.335721597985,
        33556.598095507354,
        33869.73383764436,
        34469.54732432179,
        34455.43118953119,
        35742.05632516497,
        36332.28377975791,
        35994.98232010853,
        37475.90835787767,
        36864.4136353671,
        36313.84895185083,
        36774.00714224005,
        36012.81913781724,
        36135.21679325654,
        36376.901774691425,
        36509.52663513911,
        35932.24680133195,
        36110.661230944956,
        35959.349880449605,
        36135.28460073616,
        36227.64175414463,
        36560.16026065326,
        36417.69320776084,
        36481.16149336777,
        36610.6303462437,
        36501.11089223006,
        36391.22687624427,
        36716.721776197955,
        37136.33553681814,
        37223.028970314735,
        37364.884606724365,
        37205.49296676956,
        36929.88386695326,
        36642.61270890916,
        36833.93079566088,
        36988.928510667356,
        36650.93952260846,
        36978.99375636917,
        36895.32538782498,
        37500.875439743,
        37900.84010652681,
        37720.70203910963,
        37335.639820701435,
        37372.18809056965,
        37649.69959443731,
        37739.894426062776,
        37973.51732931339,
        38106.969734092716,
        37844.12888645299,
        38184.41621869904,
        38244.32492755344,
        38005.827903658734,
        38298.77290726386,
        38096.996591364295,
        38566.22508438554,
        37238.388243166875,
        37118.28558873019,
        36480.07828971702,
        36776.53224146219,
        37007.385905588635,
        35915.054205488246,
        36104.216386999695,
        35622.94356709955,
        36058.50457844193,
        36043.99343671098,
        36246.18326868031,
        36287.64805612861,
        36543.167342822904,
        36622.35017721683,
        36408.24478693469
      ]
    }
  },
  {
    "id": "ethereum",
    "symbol": "eth",
    "name": "Ethereum",
    "image": "https://assets.coingecko.com/coins/images/279/large/ethereum.png?1595348880",
    "current_price": 2458.44,
    "market_cap": 289953248177,
    "market_cap_rank": 2,
    "fully_diluted_valuation": null,
    "total_volume": 20851817577,
    "high_24h": 2727.23,
    "low_24h": 2359.03,
    "price_change_24h": -144.453773052294,
    "price_change_percentage_24h": -5.54975,
    "market_cap_change_24h": -21708889062.14099,
    "market_cap_change_percentage_24h": -6.96552,
    "circulating_supply": 119335546.0615,
    "total_supply": null,
    "max_supply": null,
    "ath": 4878.26,
    "ath_change_percentage": -49.6303,
    "ath_date": "2021-11-10T14:24:19.604Z",
    "atl": 0.432979,
    "atl_change_percentage": 567402.36579,
    "atl_date": "2015-10-20T00:00:00.000Z",
    "roi": {
      "times": 89.46767914486297,
      "currency": "btc",
      "percentage": 8946.767914486298
    },
    "last_updated": "2022-01-27T17:57:51.668Z",
    "sparkline_in_7d": {
      "price": [
        3148.800004815061,
        3139.7891366583362,
        3177.5793522042013,
        3230.96711707207,
        3257.577670584142,
        3247.9052165955286,
        3232.714671680774,
        3236.8585596268167,
        3219.841978860526,
        3187.112843779372,
        3089.4715016399127,
        3068.796106484638,
        3006.5784160548824,
        3025.751996535001,
        2893.3845727056387,
        2931.9472877102835,
        2841.6798523520165,
        2873.699552817931,
        2874.265327847543,
        2860.792293673202,
        2896.2885712277075,
        2899.3689263521264,
        2886.8006238775633,
        2874.4946137289908,
        2854.5278178729814,
        2761.068018643326,
        2804.845377014116,
        2791.382847925218,
        2853.430700464929,
        2816.3604230527294,
        2777.4197408053537,
        2797.1284715903093,
        2766.124265319217,
        2736.878228205368,
        2570.4425268527607,
        2522.6524612632375,
        2559.1210294471675,
        2603.178722215513,
        2614.1173351265397,
        2613.228838249508,
        2560.0519644200185,
        2573.0167945120143,
        2500.09673182955,
        2516.6700981264603,
        2482.159316802162,
        2479.6895040996915,
        2386.2022729526366,
        2451.257828609809,
        2428.533035418735,
        2498.2806912632764,
        2479.6739859085133,
        2447.529487156614,
        2394.5487438674527,
        2432.0704901426056,
        2381.0641916485692,
        2343.3557174825796,
        2350.9857282732432,
        2430.9409990672984,
        2448.7165107374963,
        2388.3512378726414,
        2416.0889637078503,
        2447.899360330415,
        2452.439049061348,
        2413.8390199607225,
        2422.707422247393,
        2442.0482754792392,
        2465.472489653811,
        2462.73115350179,
        2495.850672067449,
        2506.6898950408995,
        2540.941957650751,
        2532.9305545934603,
        2504.8303755499524,
        2503.3070567308127,
        2510.3431915873502,
        2426.0093516702013,
        2445.94189950606,
        2436.4855737089774,
        2447.5745369084534,
        2417.4067654174028,
        2391.78988057131,
        2428.589538062468,
        2439.3849614636956,
        2450.7957240034702,
        2539.681907669826,
        2499.385687456599,
        2461.758822486441,
        2447.1870210740426,
        2466.6442250697687,
        2437.4250848299266,
        2441.1923490348972,
        2446.348658433862,
        2389.3561652289486,
        2393.436615390206,
        2335.3173646634837,
        2240.033553632275,
        2250.3779072948882,
        2207.4095436209614,
        2204.8151423684185,
        2218.969847270452,
        2284.823484949972,
        2264.9913073479506,
        2357.847534936095,
        2401.128463939307,
        2379.8275052376725,
        2485.863073815811,
        2449.392429854436,
        2413.9839521194044,
        2447.831512095295,
        2398.2540700390396,
        2390.039233676368,
        2413.412981286577,
        2420.405718049277,
        2376.0536565195835,
        2391.8157629684547,
        2370.507932052591,
        2385.5420859041174,
        2399.1211577710933,
        2429.800527082747,
        2426.3529159282652,
        2428.8080975552084,
        2445.1890657047184,
        2426.603952143925,
        2405.2703944515674,
        2430.2361407939457,
        2455.6026582522663,
        2470.7534590313912,
        2496.2448338107474,
        2479.4173069439894,
        2448.9145308863413,
        2421.293534576731,
        2442.5611391540056,
        2462.467375006779,
        2429.0690644024457,
        2456.7887307629167,
        2450.007789341576,
        2482.8854711288586,
        2509.8426235976804,
        2486.62156775183,
        2451.8213077509336,
        2464.4756829946505,
        2490.9245747932614,
        2493.1438690311634,
        2528.8657194284706,
        2545.324664049567,
        2538.586302990756,
        2628.738988588409,
        2640.46419840533,
        2611.234196252679,
        2618.097424524907,
        2602.8896558168626,
        2683.7180791702963,
        2532.091701449331,
        2522.670028416759,
        2429.11429423104,
        2455.8258286533064,
        2479.1864204422945,
        2395.335382083953,
        2394.2838012903494,
        2363.4682579744267,
        2401.6400907553616,
        2394.8079404734704,
        2406.0379998369212,
        2417.1300503347125,
        2439.1311096451486,
        2445.0676993047946,
        2421.8083628582367
      ]
    }
  },
  {
    "id": "dogecoin",
    "symbol": "doge",
    "name": "Dogecoin",
    "image": "https://assets.coingecko.com/coins/images/5/large/dogecoin.png?1547792256",
    "current_price": 0.141618,
    "market_cap": 18714099394,
    "market_cap_rank": 11,
    "fully_diluted_valuation": null,
    "total_volume": 937171605,
    "high_24h": 0.153398,
    "low_24h": 0.138641,
    "price_change_24h": -0.007345582298,
    "price_change_percentage_24h": -4.93111,
    "market_cap_change_24h": -1093898370.6946182,
    "market_cap_change_percentage_24h": -5.52251,
    "circulating_supply": 132670764299.894,
    "total_supply": null,
    "max_supply": null,
    "ath": 0.731578,
    "ath_change_percentage": -80.68639,
    "ath_date": "2021-05-08T05:08:23.458Z",
    "atl": 8.69e-05,
    "atl_change_percentage": 162486.95897,
    "atl_date": "2015-05-06T00:00:00.000Z",
    "roi": null,
    "last_updated": "2022-01-27T17:57:24.237Z",
    "sparkline_in_7d": {
      "price": [
        0.16527013935642296,
        0.16461851985777,
        0.16569404757193987,
        0.16842755588126632,
        0.16805995298450538,
        0.16658158881933885,
        0.1654292312629193,
        0.1660768421224417,
        0.16536709012493608,
        0.16367352577808195,
        0.15798013538776393,
        0.15812041170869817,
        0.15518205983122763,
        0.15663973634108885,
        0.1490079653099106,
        0.15325860835247473,
        0.1501064954853482,
        0.15172072222464203,
        0.15292857672798849,
        0.1523922052139898,
        0.15405232183760292,
        0.15342829432613783,
        0.154252704576081,
        0.1542594275193704,
        0.15398634711256756,
        0.14934455467343458,
        0.1520539532365232,
        0.15135175767511394,
        0.15366502441103466,
        0.15192473728570627,
        0.15144324250230257,
        0.15252790875759722,
        0.1509948491400836,
        0.14955088936135733,
        0.1406079100347482,
        0.1423098038063095,
        0.14194204387181947,
        0.14447691293193443,
        0.14442742571120357,
        0.14446191807232486,
        0.1420790949397173,
        0.1439286520789349,
        0.13701624744391355,
        0.13459171846615112,
        0.13120780360507747,
        0.1328653683843841,
        0.1257121679660065,
        0.1294104370682694,
        0.12787318828064168,
        0.13342700431971444,
        0.13325116146204422,
        0.13032971204524055,
        0.12683923098837338,
        0.1298591124300993,
        0.1267945969973158,
        0.1268675528454285,
        0.12806315908073596,
        0.13340432627382484,
        0.13410912994914745,
        0.13118112257000203,
        0.13341061121031966,
        0.13809389269749903,
        0.13864079671935628,
        0.13557588783599855,
        0.13699692567901137,
        0.13771784294816206,
        0.13859160124652933,
        0.1384601108739811,
        0.1411355505503205,
        0.13999883254337112,
        0.1420020856862917,
        0.14134626933020947,
        0.13889906166200583,
        0.13921066613841684,
        0.14154750296672938,
        0.13654719643880325,
        0.13733737265759027,
        0.13761956691150665,
        0.13991535186916093,
        0.1371110356080753,
        0.13577660837331162,
        0.13885033652992693,
        0.13844517386563626,
        0.13885194640112147,
        0.14179662458746473,
        0.14056210392017818,
        0.13918113876752589,
        0.1382131381477804,
        0.13976568184017835,
        0.1380373749064956,
        0.13772525476813913,
        0.13750487032798625,
        0.13496865590725327,
        0.13494039478004474,
        0.1315536462963864,
        0.12832176536603532,
        0.12960551199585188,
        0.12685606957006676,
        0.12860998492886774,
        0.1302741559350639,
        0.13310412581411168,
        0.13054068513323266,
        0.13396292701401932,
        0.13510980827539137,
        0.1343455884833325,
        0.13980925995521565,
        0.1373446405884953,
        0.1366576168214404,
        0.1378456284122745,
        0.13692222483397706,
        0.13609890240075534,
        0.13698102336213122,
        0.1368385938576259,
        0.1339056674005509,
        0.1341984299815242,
        0.1335123652856829,
        0.13435815117065758,
        0.1348210280190746,
        0.13629619005429353,
        0.13602495270374362,
        0.13605787270680206,
        0.14059236975640368,
        0.14031656896789682,
        0.1389139861299434,
        0.13994392681034007,
        0.1417529895573021,
        0.14205318856994753,
        0.1441842638878466,
        0.1442289339320765,
        0.14310966990856372,
        0.1416991785520169,
        0.142676490315461,
        0.14377678720823212,
        0.14229903222260706,
        0.14426471685515393,
        0.143987065476399,
        0.14617321103865555,
        0.14758185409489794,
        0.14612841442363483,
        0.14333943289629894,
        0.14440773492313105,
        0.14530331136935518,
        0.14580397656053842,
        0.1491830505384628,
        0.15077541817014792,
        0.1487146569214388,
        0.150417115731563,
        0.1504324061718674,
        0.14967383797194167,
        0.1504494342572629,
        0.1489640753224096,
        0.15099544394050254,
        0.1467150505689843,
        0.14662469187526928,
        0.14219946740537667,
        0.14403854448933417,
        0.14431605535428996,
        0.13950451496383365,
        0.14090412989789527,
        0.13970465327539638,
        0.14043488419354858,
        0.1406961598496072,
        0.14124582440510772,
        0.1416089902687694,
        0.14194665856303146,
        0.1415481856170522,
        0.14146634581054923
      ]
    }
  },
  {
    "id": "litecoin",
    "symbol": "ltc",
    "name": "Litecoin",
    "image": "https://assets.coingecko.com/coins/images/2/large/litecoin.png?1547033580",
    "current_price": 107.54,
    "market_cap": 7446691175,
    "market_cap_rank": 21,
    "fully_diluted_valuation": 8999280437,
    "total_volume": 926435490,
    "high_24h": 116.81,
    "low_24h": 103.23,
    "price_change_24h": -3.911045337503,
    "price_change_percentage_24h": -3.50925,
    "market_cap_change_24h": -311023090.3046942,
    "market_cap_change_percentage_24h": -4.00921,
    "circulating_supply": 69508008.2334713,
    "total_supply": 84000000.0,
    "max_supply": 84000000.0,
    "ath": 410.26,
    "ath_change_percentage": -73.84689,
    "ath_date": "2021-05-10T03:13:07.904Z",
    "atl": 1.15,
    "atl_change_percentage": 9239.46276,
    "atl_date": "2015-01-14T00:00:00.000Z",
    "roi": null,
    "last_updated": "2022-01-27T17:57:33.842Z",
    "sparkline_in_7d": {
      "price": [
        138.0640156182648,
        137.64429636767946,
        139.10952020590068,
        141.74876031007577,
        142.26449341925704,
        142.4815842475662,
        141.37096693300074,
        141.88970063035276,
        141.32512988369893,
        140.08191086702158,
        134.75407723646603,
        133.68251126397396,
        130.42414169230446,
        130.5102465532127,
        123.54263997238749,
        126.13107644035762,
        123.1033775805363,
        124.5397725905078,
        125.29221724360733,
        125.01886164066327,
        126.16764846066071,
        125.70372630622788,
        125.52080091600335,
        125.06320044624292,
        124.84844681588437,
        119.548571519586,
        122.22611153920388,
        121.9501812211546,
        124.59576825724366,
        123.09018811070952,
        121.94708005720297,
        122.4807258329871,
        121.30693213066523,
        119.96267102813802,
        111.82851778083904,
        111.7564583855429,
        113.48931581917998,
        115.04695598215142,
        115.91881869660094,
        115.28659225742192,
        112.76993725239554,
        113.4085590463604,
        108.31368636787313,
        109.40723369016715,
        106.92505386636793,
        107.4855958050622,
        101.9649986475926,
        105.80192382201113,
        105.03558554853929,
        109.16902466827602,
        108.64041307558904,
        107.29525966058559,
        105.32215567804901,
        108.04147892719591,
        106.11838940900763,
        105.2650748317833,
        106.3531077103585,
        109.77997172937732,
        110.05126439259688,
        107.67357308412278,
        108.61322367845514,
        110.21642710424902,
        109.51547289882562,
        106.41807318819514,
        107.22796851710729,
        107.9006430211142,
        108.77619141229896,
        108.29150728154693,
        109.47867968496946,
        109.51660934227678,
        110.75056043148273,
        110.41852064705186,
        110.09123760187849,
        110.26972975438649,
        110.78049271151751,
        106.657933914559,
        107.49142760690562,
        107.71974506973176,
        108.03033788440382,
        106.72935968474292,
        107.27910881425375,
        108.9854015737503,
        108.92088077288825,
        108.42594008768953,
        112.10172768880639,
        110.54240536009041,
        108.89951622553802,
        107.76038587930587,
        109.02610503198223,
        107.94194003475828,
        108.45932986568367,
        108.19409239347384,
        105.73962366723019,
        106.04934235516416,
        103.40767255421267,
        99.71752632523751,
        101.16646459225878,
        99.65580897390785,
        99.89211609451621,
        100.65161016327356,
        103.6858032344517,
        102.49134992688111,
        106.44988251114333,
        108.64729789075491,
        107.51508827405975,
        112.16360155235539,
        109.89621688107123,
        108.4997759696926,
        109.98250709501697,
        107.49402077329076,
        107.58621801363343,
        108.35041915246993,
        108.30117021415828,
        106.05603480511435,
        107.10849976219481,
        106.58485402465824,
        107.13588035241881,
        107.8957942487241,
        108.73672356955383,
        107.90692490356524,
        108.22280425446354,
        107.91407332408085,
        106.9852794489454,
        106.67335565266924,
        107.52421752665563,
        108.90713184281441,
        108.91721647102887,
        109.51765741497248,
        108.31250231567074,
        107.9438025164818,
        107.14135278233572,
        107.8709878229325,
        108.20005922670708,
        106.94885888292302,
        108.401160218405,
        107.91189328373483,
        109.09494639507723,
        110.52300861984158,
        109.90521112329473,
        108.48047720606,
        108.74052448627678,
        108.98899593194044,
        109.38543603301393,
        110.14874595077221,
        110.76602103509497,
        110.24203733798049,
        112.35314433921909,
        112.32258649403512,
        111.61177524951732,
        112.04470523836984,
        111.44961114288466,
        115.01312986891432,
        109.64308419330047,
        108.62676816275594,
        105.18397204428273,
        107.03686549837067,
        107.51059089647316,
        104.76732249563408,
        104.73466608139519,
        103.49423227697018,
        105.0909336092734,
        105.44647300107881,
        106.00830648959807,
        106.89084288019622,
        107.56523290046465,
        108.54247601927321,
        107.2625039859947
      ]
    }
  }
]

it('should create the correct number of alerts', () => {
  let asset = marketData.find(e => e.id === "bitcoin")
  // last 24h alert was less than 24 hours ago
  let priceAlerts = [
    {
      id: 'd2d4a789-e7c8-4559-98c8-9ea35c5521f2',
      asset_id: 'bitcoin',
      asset_name: 'Bitcoin',
      price_increased: false,
      price_change: -4.9038,
      date: '2022-01-25T00:00:00',
      days: 1,
      hidden: false
    }
  ]
  let callback = (alert) => {
    //console.log("callback: new alert: ", alert)
    priceAlerts.push(alert)
  }
  let now = new Date('2022-01-25T23:59:59')
  checkPriceAlerts(now, asset, priceAlerts, callback)
  expect(priceAlerts.length).toEqual(1)
  // last 24h alert was more than 24 hours ago
  priceAlerts = [
    {
      id: 'd2d4a789-e7c8-4559-98c8-9ea35c5521f2',
      asset_id: 'bitcoin',
      asset_name: 'Bitcoin',
      price_increased: false,
      price_change: -4.9038,
      date: '2022-01-25T00:00:00',
      days: 1,
      hidden: false
    }
  ]
  let callback2 = (alert) => {
    //console.log("callback2: new alert: ", alert)
    priceAlerts.push(alert)
  }
  now = new Date('2022-01-26T00:00:01')
  checkPriceAlerts(now, asset, priceAlerts, callback2)
  expect(priceAlerts.length).toEqual(2)
  // more alerts
  priceAlerts = [
    {
      id: 'd2d4a789-e7c8-4559-98c8-9ea35c5521f2',
      asset_id: 'bitcoin',
      asset_name: 'Bitcoin',
      price_increased: false,
      price_change: -4.9038,
      date: '2022-01-02T00:00:00',
      days: 1,
      hidden: false
    },
    {
      id: '1214fd26-398c-4f0f-83d1-4fd10f0a2870',
      asset_id: 'bitcoin',
      asset_name: 'Bitcoin',
      price_increased: false,
      price_change: -23.43,
      date: '2022-01-02T00:00:00',
      days: 7,
      hidden: false
    }
  ]
  let callback3 = (alert) => {
    //console.log("callback3: new alert: ", alert)
    priceAlerts.push(alert)
  }
  now = new Date('2022-01-26T00:00:01')
  checkPriceAlerts(now, asset, priceAlerts, callback3)
  expect(priceAlerts.length).toEqual(3)
  now = new Date('2022-01-26T00:00:04')
  checkPriceAlerts(now, asset, priceAlerts, callback3)
  expect(priceAlerts.length).toEqual(3)
  // last 7d alert was less than 7 days ago
  priceAlerts = [
    {
      id: 'd2d4a789-e7c8-4559-98c8-9ea35c5521f2',
      asset_id: 'bitcoin',
      asset_name: 'Bitcoin',
      price_increased: false,
      price_change: -4.9038,
      date: '2022-01-26T10:00:00',
      days: 1,
      hidden: false
    },
    {
      id: '1214fd26-398c-4f0f-83d1-4fd10f0a2870',
      asset_id: 'bitcoin',
      asset_name: 'Bitcoin',
      price_increased: false,
      price_change: -23.43,
      date: '2022-01-21T00:00:00',
      days: 7,
      hidden: false
    }
  ]
  let callback4 = (alert) => {
    //console.log("callback: new alert: ", alert)
    priceAlerts.push(alert)
  }
  now = new Date('2022-01-26T00:00:04')
  checkPriceAlerts(now, asset, priceAlerts, callback4)
  expect(priceAlerts.length).toEqual(2)
  // last 7d alert was more than 7 days ago
  priceAlerts = [
    {
      id: 'b9ac909b-7385-4596-91cd-f9dd39cb1296',
      asset_id: 'ethereum',
      asset_name: 'Ethereum',
      price_increased: false,
      price_change: -5.54975,
      date: '2022-01-27T20:40:33.594Z',
      days: 1,
      hidden: false
    },
    {
      id: 'e59920f2-0e87-4a91-ba13-0f5acb4a3532',
      asset_id: 'ethereum',
      asset_name: 'Ethereum',
      price_increased: false,
      price_change: -29.57125827585072,
      date: '2022-01-21T20:40:33',
      days: 7,
      hidden: false
    }

  ]
  let callback5 = (alert) => {
    //console.log("callback5: new alert: ", alert)
    priceAlerts.push(alert)
  }
  now = new Date('2022-01-27T00:00:04')
  checkPriceAlerts(now, asset, priceAlerts, callback5)
  expect(priceAlerts.length).toEqual(3)
})

it('should create the first alert correctly', () => {
  let asset = marketData.find(e => e.id === "ethereum")
  let priceAlerts = []
  let callback = (alert) => {
    priceAlerts.push(alert)
  }
  let now = new Date('2022-01-25T23:59:59')
  checkPriceAlerts(now, asset, priceAlerts, callback)
  expect(priceAlerts.length).toEqual(2)
})